<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#6366f1">
    <title>Time Budget Tracker v2</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Quick Action Floating Widget -->
    <div class="quick-action-widget" id="quickWidget">
        <div class="quick-widget-content">
            <div class="quick-widget-icon" id="quickIcon">â°</div>
            <div class="quick-widget-info">
                <div class="quick-widget-name" id="quickName">No active activity</div>
                <div class="quick-widget-timer" id="quickTimer">--:--:--</div>
            </div>
            <button class="quick-widget-btn" id="quickBtn" onclick="tracker.quickAction()">Start</button>
        </div>
    </div>

    <!-- Main Header -->
    <div class="header">
        <div class="header-top">
            <h1>â° Time Budget</h1>
            <div class="day-badge" id="dayBadge">Loading...</div>
        </div>
        
        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-mini">
                <div class="stat-mini-value" id="totalVariance">0m</div>
                <div class="stat-mini-label">Variance</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-value" id="totalCalories">0</div>
                <div class="stat-mini-label">ğŸ”¥ Cal</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-value" id="streakCount">0</div>
                <div class="stat-mini-label">ğŸ”¥ Streak</div>
            </div>
            <div class="stat-mini">
                <div class="stat-mini-value" id="completionRate">0%</div>
                <div class="stat-mini-label">Done</div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-bar">
            <button class="nav-btn active" onclick="tracker.showView('cards')" id="navCards">
                ğŸ¯ Track
            </button>
            <button class="nav-btn" onclick="tracker.showView('heatmap')" id="navHeatmap">
                ğŸ“Š Heatmap
            </button>
            <button class="nav-btn" onclick="tracker.showView('insights')" id="navInsights">
                ğŸ’¡ Insights
            </button>
            <button class="nav-btn" onclick="tracker.showView('settings')" id="navSettings">
                âš™ï¸ Settings
            </button>
        </div>
    </div>

    <!-- Deviation Alerts -->
    <div class="alerts-container" id="alertsContainer"></div>

    <!-- Swipeable Cards View -->
    <div id="cardsView" class="view-container">
        <div class="swipe-indicator">
            <span class="swipe-arrow">â†</span>
            <span class="swipe-text">Swipe to navigate</span>
            <span class="swipe-arrow">â†’</span>
        </div>
        <div class="cards-container" id="cardsContainer">
            <div class="activity-card">
                <div class="card-loading">Loading activities...</div>
            </div>
        </div>
        <div class="card-dots" id="cardDots"></div>
    </div>

    <!-- Weekly Heatmap View -->
    <div id="heatmapView" class="view-container" style="display: none;">
        <div class="container">
            <h2 class="view-title">ğŸ“Š Weekly Heatmap</h2>
            <div class="heatmap-legend">
                <span class="legend-item"><span class="legend-color" style="background: var(--success);"></span> Complete</span>
                <span class="legend-item"><span class="legend-color" style="background: var(--warning);"></span> Partial</span>
                <span class="legend-item"><span class="legend-color" style="background: var(--danger);"></span> Missed</span>
                <span class="legend-item"><span class="legend-color" style="background: var(--border);"></span> Not tracked</span>
            </div>
            <div id="heatmapGrid" class="heatmap-grid"></div>
        </div>
    </div>

    <!-- Insights View -->
    <div id="insightsView" class="view-container" style="display: none;">
        <div class="container">
            <h2 class="view-title">ğŸ’¡ Smart Insights</h2>
            <div id="insightsList" class="insights-list"></div>
        </div>
    </div>

    <!-- Settings View -->
    <div id="settingsView" class="view-container" style="display: none;">
        <div class="container">
            <h2 class="view-title">âš™ï¸ Settings</h2>
            
            <!-- Template Days -->
            <div class="settings-section">
                <h3 class="section-title">ğŸ“… Template Days</h3>
                <div class="template-buttons">
                    <button class="template-btn" onclick="tracker.applyTemplate('sick')">ğŸ¤’ Sick Day</button>
                    <button class="template-btn" onclick="tracker.applyTemplate('travel')">âœˆï¸ Travel Day</button>
                    <button class="template-btn" onclick="tracker.applyTemplate('holiday')">ğŸ‰ Holiday</button>
                    <button class="template-btn" onclick="tracker.applyTemplate('reset')">ğŸ”„ Reset to Default</button>
                </div>
            </div>

            <!-- Activity Settings -->
            <div class="settings-section">
                <h3 class="section-title">ğŸ¯ Activity Settings</h3>
                <div id="activitySettings" class="activity-settings-list"></div>
            </div>

            <!-- Notification Settings -->
            <div class="settings-section">
                <h3 class="section-title">ğŸ”” Notifications</h3>
                <div class="notification-settings">
                    <label class="setting-row">
                        <span>Enable Notifications</span>
                        <input type="checkbox" id="notificationsToggle" onchange="tracker.toggleNotifications(this.checked)">
                    </label>
                    <label class="setting-row">
                        <span>Reminder Minutes Before</span>
                        <input type="number" id="reminderMinutes" value="5" min="0" max="30" onchange="tracker.updateReminderTime(this.value)">
                    </label>
                </div>
            </div>

            <!-- Export Data -->
            <div class="settings-section">
                <h3 class="section-title">ğŸ’¾ Data Management</h3>
                <button class="action-btn primary" onclick="tracker.exportWeek()">ğŸ“¥ Export This Week</button>
                <button class="action-btn danger" onclick="tracker.clearAllData()">ğŸ—‘ï¸ Clear All Data</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-title">Stop Timer?</div>
            <p class="modal-text">Save this session?</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="tracker.closeModal()">Cancel</button>
                <button class="btn btn-danger" onclick="tracker.confirmStop()">Stop & Save</button>
            </div>
        </div>
    </div>

    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-title">Add Missed Activity</div>
            <p class="modal-text">This won't count toward your streak.</p>
            <input type="number" id="historyMinutes" placeholder="Minutes" min="1" class="modal-input">
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="tracker.closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="tracker.saveHistory()">Add History</button>
            </div>
        </div>
    </div>

    <div class="modal" id="manualStartModal">
        <div class="modal-content">
            <div class="modal-title">Manual Start Time</div>
            <p class="modal-text">When did you actually start?</p>
            <input type="time" id="manualStartTime" class="modal-input">
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="tracker.closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="tracker.confirmManualStart()">Start Now</button>
            </div>
        </div>
    </div>

    <div class="modal" id="templateConfirmModal">
        <div class="modal-content">
            <div class="modal-title">Apply Template?</div>
            <p class="modal-text" id="templateConfirmText"></p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="tracker.closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="tracker.confirmTemplate()">Apply</button>
            </div>
        </div>
    </div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        ğŸ’¡ <strong>Install App:</strong> Tap Share â†’ Add to Home Screen
        <button class="install-close" onclick="document.getElementById('installPrompt').style.display='none'">Ã—</button>
    </div>

    <script src="app.js"></script>
</body>
</html>
